# Click the Variables button, above, to create your own variables

PUT construction
{
  "mappings": {
    "properties": {
      "project_id": { "type": "keyword" },
      "foreman_id": { "type": "keyword" },
      "work_stages": {
        "type": "nested",
        "properties": {
          "stage_id": { "type": "keyword" },
          "stage_name": { "type": "text" },
          "stage_status": { "type": "keyword" },
          "tasks": {
            "type": "nested",
            "properties": {
              "task_id": { "type": "keyword" },
              "task_name": { "type": "text" },
              "task_description": { "type": "text" },
              "task_status": { "type": "keyword" },
              "time_intervals": {
                "type": "nested",
                "properties": {
                  "start_time": { "type": "date" },
                  "end_time": { "type": "date" },
                  "status": { "type": "keyword" }
                }
              },
              "subtasks": {
                "type": "nested",
                "properties": {
                  "subtask_id": { "type": "keyword" },
                  "subtask_name": { "type": "text" },
                  "subtask_status": { "type": "keyword" },
                  "subtask_description": { "type": "text" },

                  /* старое assignees убрано */
                  "brigade_id": { "type": "keyword" },

                  /* опционально: snapshot состава на момент назначения */
                  "brigade_snapshot": {
                    "type": "nested",
                    "properties": {
                      "brigade_name": { "type": "text" },
                      "members": {
                        "type": "nested",
                        "properties": {
                          "user_id": { "type": "keyword" },
                          "email": { "type": "keyword" }
                        }
                      }
                    }
                  },

                  "properties": {
                    "start": { "type": "date" },
                    "end": { "type": "date" }
                  },
                  "plannedQty": { "type": "float" },
                  "actualQty": { "type": "float" },
                  "machine": {
                    "type": "object",
                    "properties": {
                      "hours": { "type": "float" },
                      "number": { "type": "keyword" }
                    }
                  },
                  "reportLinks": {
                    "type": "nested",
                    "properties": {
                      "title": { "type": "text" },
                      "href": { "type": "keyword" }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}




POST construction/_doc/p1
{
  "project_id": "p1",
  "foreman_email": "user@example.com",
  "foreman_id": "ebaf42b2-c945-400d-bb11-6a17f9e4a0dc",
  "work_stages": [
    {
      "stage_id": "s1",
      "stage_name": "Фундамент",
      "stage_status": "В работе",
      "tasks": [
        {
          "task_id": "t1",
          "task_name": "Подготовка площадки",
          "task_description": "Очистка территории перед заливкой бетона",
          "task_status": "Завершено",
          "subtasks": [
            {
              "subtask_id": "st1",
              "subtask_name": "Вывоз мусора",
              "subtask_status": "Завершено",
              "subtask_description": "Убрать строительный мусор",
              "brigade_id": "b1",
              "brigade_snapshot": {
                "brigade_name": "Бригада А",
                "members": [
                  { "user_id": "worker1", "email": "w1@example.com" },
                  { "user_id": "worker2", "email": "w2@example.com" }
                ]
              },
              "deadline": { "start": "2025-08-16", "end": "2025-08-16"},
              "plannedQty": 10,
              "actualQty": 12,
              "machine": { "hours": 5, "number": "123" },
              "reportLinks": [ { "title": "Фото отчёт", "href": "http://example.com/report1" } ],
              "time_intervals": [
                { "start_time": "2025-08-16T08:00:00", "end_time": "2025-08-16T17:00:00", "status": "closed" }
              ]
            }
          ]
        }
      ]
    }
  ]
}




DELETE construction
GET construction/_refresh


PUT users
{
  "settings": {
    "analysis": {
      "normalizer": {
        "lowercase_norm": {
          "type": "custom",
          "filter": ["lowercase"]
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "email": {
        "type": "keyword",
        "normalizer": "lowercase_norm"
      },
      "hashed_password": { "type": "keyword" },
      "role": { "type": "keyword" },
      "is_active": { "type": "boolean" },
      "created_at": { "type": "date" }
    }
  }
}

GET users/_refresh
GET users/_search
DELETE users
DELETE construction
GET construction/_search

GET construction/_refresh

POST users/_update/12c79727-ebd2-40c3-a31b-3bfefff7a7cb
{
  "doc": {
    "role": "root"
  }
}


PUT brigades
{
  "mappings": {
    "properties": {
      "brigade_id": { "type": "keyword" },
      "brigade_name": { "type": "text" },
      "members": {
        "type": "nested",
        "properties": {
          "user_id": { "type": "keyword" },
          "email": { "type": "keyword" }
        }
      },
      "created_at": { "type": "date" },
      "created_by": { "type": "keyword" }
    }
  }
}

POST brigades/_doc/b1
{
  "brigade_id": "b1",
  "brigade_name": "Бригада А",
  "members": [
    { "user_id": "worker1", "email": "w1@example.com" },
    { "user_id": "worker2", "email": "w2@example.com" }
  ],
  "created_at": "2025-08-01T12:00:00Z",
  "created_by": "ebaf42b2-c945-400d-bb11-6a17f9e4a0dc"
}